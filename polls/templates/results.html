{% extends "base.html" %}
{% block content %}

<div class="container">
    <div class="row">
        <div class="span8">

            {% if poll.has_expired %}
                <div class="alert alert-error">
                    Poll has expired!
                </div>
            {% endif %}

            <h1>{{ poll.question }}</h1>

            <div id="graph"></div>
            <div id="canvas_container"></div>
        </div>
        <div class="span4">
            <h2>Poll Fun Facts</h2>
            <ul>
                <li>Date Created: {{ poll.date_created }}</li>
                <li>Date to Expire: {{poll.date_expire }}</li>
                <li>Total Votes: {{ poll.total_votes }}</li>
        </div>
    </div>
</div>


{% endblock %}

{% block scripts %}
    <style type="text/css">
        #canvas_container {
            width: 500px;
            height: 300px;
        }
    </style>
    <script type="text/javascript" src="{{STATIC_URL}}graphing/raphael-min.js"></script>
    <script type="text/javascript" src="{{STATIC_URL}}graphing/fancygraphs.js"></script>
    <script type="text/javascript">
        $(document).ready(function(){
            var data = [{% spaceless %}
            {% for choice, votes in poll.results %}['{{choice|escapejs}}', {{votes}}]{% if not forloop.last %},{% endif %}{% endfor %}];
            {% endspaceless %}
            var choiceIds = [{% spaceless %}
            {% for choice in poll.choice_set.all %} {{ choice.id }}{% if not forloop.last %},{% endif %}{% endfor %}];
            {% endspaceless %}
            graph($('#canvas_container').get(0), data, "{{ poll.get_vote_url }}", choiceIds, "{{ csrf_token }}", {});
        });
    </script>
{% endblock %}
