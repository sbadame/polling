{% extends "base.html" %}
{% load polls %}

{% block content %}
<div class="container">
    <div class="row">
    <div class="span6">
        <h2> Create a Poll! </h2>
        {% if error_message %}
            <h3> {{ error_message }} </h3>
        {% endif %}
        <form action="/create" id="pollForm" method="post">
            {% csrf_token %}
            <input type="radio" name="pub_priv" value="Public" checked>Make Public Poll <br>
            <input type="radio" name="pub_priv" value="Private">Make Private Poll<br><br>

            <noscript>
                Question:
            </noscript>
            <input type="text" name="question" id="questioninput" onblur="if
            (this.value == '') {this.value = 'Enter Your Question Here';}" onfocus="if (this.value == 'Enter Your Question Here') {this.value = '';}" />
            <br />
            <div id="options">

                <noscript> Choice 1: </noscript> 
                <input type="text" name="choice1" id="choice1input" />
                <br />

                <noscript> Choice 2: </noscript> 
                <input type="text" name="choice2" id="choice2input" />
                <br />

                <noscript>
                    <!-- Since the "Add another choice button" doesn't really work for non js
                        Give the noscript people a couple more choices by default -->

                    Choice 3: <input type="text" name="choice3" id="choice3input" />
                    <br/>
                    Choice 4: <input type="text" name="choice4" id="choice4input" />
                </noscript>
            </div>
            <div id="addOptionContainer">
            </div>
            <br />
            <input type="submit" class="btn-large btn-primary" value="Create Poll!" />
        </form>
    </div>
    <div class="span6">
        <h2>Check out an Example...</h2>
        <h3>{{ random_poll.question }}</h3>
        <div id="graph"></div>
        <div id="canvas_container">
            <noscript>
                <img src="{{ random_poll.get_image_url }}"/>
                <form class="well form-inline" action="{{ random_poll.get_vote_url }}" method="post">
                {% csrf_token %}
                    Vote For:
                    {% for choice in random_poll.choice_set.all %}
                        <input type="submit" value="{{ choice.choice }}" name="choice" />
                    {% endfor %}
                </form>
            </noscript>
        </div>
    </div>
    </div>
<div class="row">
    <div class="span4">
        {% if latest_poll_list %}
            <h2>Newest Polls</h2>
            <ul>
                {% for poll in latest_poll_list %}
                <li><a href="{{ poll.get_absolute_url }}">{{ poll.question }}</a></li>
                {% endfor %}
            </ul>
        {% endif %}
    </div>
    <div class="span4">
        <h2>Most Popular Polls</h2>
        <ul>
            {% for poll in popular_poll_list %}
            <li><a href="{{ poll.get_absolute_url }}">{{ poll.question }}</a></li>
            {% endfor %}
        </ul>
    </div>
    <div class="span4">
        <h2>Polls About To Expire</h2>
        <ul>
            {% for poll in danger_poll_list %}
            <li><a href="{{ poll.get_absolute_url }}">{{ poll.question }}</a></li>
            {% endfor %}
        </ul>
    </div>
</div>
</div><!-- close container -->


{% endblock %}

{% block scripts %}
    <script type="text/javascript">
        eventHandlers = {
            'focus': function(){
                //Find the first number in the choice,
                var index = this.id.match(/\d+/);
                if ($(this).val() == "Choice " + index) {
                    $(this).val('');
                }
            },

            'blur': function(){
                //Find the first number in the choice,
                var index = this.id.match(/\d+/);
                if ($(this).val() == "") {
                    $(this).val('Choice ' + index);
                }
            }
        };

        optionCount = 3;
        function addPollOption() {
            options = document.getElementById("options");

            // Input
            input = document.createElement("input");
            options.appendChild(input);
            options.appendChild(document.createElement("br"));

            input.type = "text";
            input.name = "choice" + optionCount;
            input.id = "choice" + optionCount + "input";
            $(input).val("Choice " + optionCount);

            optionCount++;
            $(input).bind(eventHandlers);
        }

        $(document).ready(function(){
            inputs = $("#options input:text");
            inputs.bind(eventHandlers);
            inputs.val(function (index) {
                return "Choice " + (index + 1);
            });

            var addChoiceButton = document.createElement('input');
            addChoiceButton.type = "button";
            $(addChoiceButton).addClass("btn-small btn");
            addChoiceButton.onclick = addPollOption;
            addChoiceButton.value = "Add Another Choice";

            var container = document.getElementById("addOptionContainer");
            container.appendChild(addChoiceButton);

            $("#questioninput").val("Enter Your Question Here");

        });
    </script>
    {% poll_script random_poll #canvas_container %}
{% endblock %}
